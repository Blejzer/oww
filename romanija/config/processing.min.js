var mysql=require("mysql");var Config=require("config-js");var config=new Config(process.env.OWW_ROOT_PATH+"/application/config/config.js");console.log(process.env);var dbcon=mysql.createPool({connectionLimit:process.env.DB_VAR_CONN,host:process.env.DB_VAR_LINK,user:process.env.DB_VAR_JUZER,password:process.env.DB_VAR_LOZINKA,database:process.env.DB_VAR_BAZA,port:process.env.DB_VAR_PORT});module.exports={insertEvent:function(a,b){console.log("DATA: Event: %s",a.title,a.path,a.week);dbcon.getConnection(function(d,c){var e;var f=false;c.query("SELECT * FROM tevent where week_id = ?",a.week,function(h,g){if(h){throw h}console.log("wrows: ",g);if(g[0]){console.log("Event for the week: ",g[0].week_id,"already exists!");b({weekcheck:f,event_id:null});c.release()}else{f=true;c.query(config.get("evnt.ins"),[a.title,a.path,a.week],function(i,j){if(i){if(i.fatal){throw i}console.error("Processor: Insert: Event: ",new Date(),config.get("poruke.upitNijeOK"),i.code,i)}console.log("Insert event ID: ",j.insertId);e=j.insertId;b({weekcheck:f,event_id:j.insertId});c.release()})}})})},insertPerson:function(a,b){console.log("DATA: Person: %s",a.title,a.path,a.week);dbcon.getConnection(function(e,c){var d;var f=false;c.query("SELECT * FROM tperson where week_id = ?",a.week,function(h,g){if(h){throw h}console.log("wrows: ",g);if(g[0]){console.log("Person for the week: ",g[0].week_id,"already exists!");b({weekcheck:f,event_id:null});c.release()}else{f=true;c.query(config.get("prsn.ins"),[a.title,a.path,a.week],function(i,j){if(i){if(i.fatal){throw i}console.error("Processor: Insert: Person: ",new Date(),config.get("poruke.upitNijeOK"),i.code,i)}console.log("Insert person ID: ",j.insertId);d=j.insertId;b({weekcheck:f,person_id:d});c.release()})}})})},mainLists:function(a){console.log("DATA: Main Page Lists");dbcon.getConnection(function(d,b){var e,c=new Array(5);b.query(config.get("prsn.lst"),function(f,g){if(f){if(f.fatal){throw f}console.error("DATA: Main Person List: %s: ",new Date(),config.get("poruke.upitNijeOK"),f.code,f.fatal)}b.query(config.get("evnt.lst"),function(i,j){if(i){if(i.fatal){throw i}console.error("DATA: Main Event List: %s: ",new Date(),config.get("poruke.upitNijeOK"),i.code,i.fatal)}e=g;c=j;var h=({eventList:j,personList:g});a(h);b.release()})})})},listPersons:function(a,b){}};